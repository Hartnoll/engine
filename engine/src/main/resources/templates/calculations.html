<!DOCTYPE html>
<html lang="en">
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Calculation</title>
    <link rel="shortcut icon" type="image/jpg" href="bristol.jpg"/>
    <script src="js/libraries/p5.min.js"></script>
    <link rel="stylesheet" href="js/style.css">
</head>
<body>
<div id = "Engine Calculation" style ="width:100%"></div>
<div id="header" style="background-color:#E6E6FA;text-align:center">
    <h1 style="margin-bottom:0;">Engine Calculation</h1></div>

<div id="step1" style="background-color:#F0FFFF;height:400px;width:30%;float:left;">

    <b>Step 1</b><br>
    Enter the initial parameters of the experiment.<br>
    <br>
    <br>
    <br>
    Fuel drop length = <td><input type="text" id="fuelDropLength" size ="5" required/></td> cm<br>
    Choose the fuel type: <br>
    <input type="radio" name="Q1" value="A" onClick=Q1.value required/>  Petrol<br>
    <input type="radio" name="Q1" value="B" onClick=Q1.value required/>  Diesel<br>
    <br>
    <br>
    <input type="button" onclick="checkStepOne()" value="Next">
</div>

<div id="step2" style="background-color:#F5FFFA;height:400px;width:30%;float:left;">
    <b>Step 2</b><br>
    Enter your readings.<br>
    <br>
    <br>
    <br>
    Speed = <td><input type="text" id="speed" size ="5" required/></td> rpm<br>
    Torque = <td><input type="text" id="torque" size ="5" required/></td> Nm (with 1 decimal place)<br>
    Fuel time = <td><input type="text" id="fuelTime" size ="5" required/></td> s (with 2 decimal places)<br>
    <br>
    <br>
    <br>
    <br>
    <input type="button" onclick="checkStepTwo()" value="Next">
</div>

<div id="step3" style="background-color:#F0FFF0;height:400px;width:40%;float:left;">
    <b>Step 3</b><br>
    Enter the results of your calculations<br>
    <br>
    <br>
    <br>
    Fuel Flow = <td><input type="text" id="fuel flow" size ="5" required/></td> kg/s (3 sig.fig.)<br>
    Brake Power = <td><input type="text" id="brake power" size ="5" required/></td> W (3 s.f.)<br>
    Fuel Power = <td><input type="text" id="fuel power" size ="5" required/></td> W (3 s.f.)<br>
    Brake Thermal Efficiency = <td><input type="text" id="brake thermal efficiency" size ="5" required/></td> % (3 s.f.)<br>
    <br>
    <br>
    <br>
    <input type="button" onclick="checkStepThree()" value="Check">
</div>

<script type="text/javascript">
    function selectFuelType(name) {
        var j = 0;
        var fuelType = document.getElementsByName(name)
        for (i = 0; i < fuelType.length; i++) {
            if (fuelType[i].checked) {
                j++;
                // alert("checked" + fuelType[i].value);
                break;
            }
        }
        if (j == 0) return false;
        else return true;
    }

    function checkFuelType(name) {
        var fuelType = document.getElementsByName(name)
        for (i = 0; i < fuelType.length; i++) {
            if (fuelType[i].checked) {
                return fuelType[i].value;
                break;
            }
        }
    }

    function checkInput(id){
        var m = document.getElementById(id);
        if(isNaN(Number(m.value))){
            alert("Your input should be numbers! Symbols other than the decimal point are not allowed!");
           // break;
           return false;
        }
        return true;
    }

    // function checkFuelType() {
    //     var q1 = selectFuelType("Q1");
    //     if (q1 == false) {
    //         alert("Please choose a fuel type!");
    //         return false;
    //     }
    // }

    function checkFuelDropLength(id){
        var fuelDropLength = document.getElementById(id);
        if (fuelDropLength.value < 0 || fuelDropLength.value > 7.5) {
            alert("please enter a valid fuel drop length!");
            return false;
        }
        return true;
    }

    function checkStepOne(){
        if (checkInput("fuelDropLength")){
          checkFuelDropLength("fuelDropLength");
          var q1 = selectFuelType("Q1");
          if (q1 == false) {
            alert("Please choose a fuel type!");
          }
         // alert("Are you sure to go to next step?");
        }
    }

    function checkStepTwo(){
        var speed = document.getElementById("speed");
        var torque = document.getElementById("torque");
        var fuelTime = document.getElementById("fuelTime");
        var s = parseInt(speed.value);
        var t = parseFloat(torque.value);
        var ft = parseFloat(fuelTime.value);
        var allSpeed = [1400,1500,1600,1700,1800,1900,2000,2100,2200,2300,2400];

        a = checkInput("speed");
        b = checkInput("torque");
        c = checkInput("fuelTime");
        
        if (a & b & c){
          for (i = 0; i < allSpeed.length; i++){
            if (s == allSpeed[i]){
                break;
            }
            if (i == allSpeed.length - 1){
                alert("This is not a valid speed!");
            }
          }

          if (checkFuelType("Q1") == "A"){
            if (t >= 26 || t <=19){
                alert("This is not a valid torque for petrol!")
            }
            if (ft >= 22 || ft <= 14){
                alert("This is not a valid fuel time for petrol!")
            }
          }

          if (checkFuelType("Q1") == "B") {
            if (t >= 32 || t <= 26) {
                alert("This is not a valid torque for diesel!")
            }
            if (ft >= 25 || ft <= 10) {
                alert("This is not a valid fuel time for diesel!")
            }
          }
          //alert("Are you sure to go to the final step?")
        }
    }

    function data(x){
        if (x >= 1000){
            return Math.round(x)
        }
        return x.toPrecision(3)
    }   

    function checkStepThree(){
        var flow = document.getElementById("fuel flow");
        var bPower = document.getElementById("brake power");
        var fPower = document.getElementById("fuel power");
        var efficiency = document.getElementById("brake thermal efficiency");
        var fuelDropLength = document.getElementById("fuelDropLength");
        var fuelTime = document.getElementById("fuelTime");
        var speed = document.getElementById("speed");
        var torque = document.getElementById("torque");
        var s = parseInt(speed.value);
        var t = parseFloat(torque.value);
        var ft = parseFloat(fuelTime.value);

        a = checkInput("fuel flow");
        b = checkInput("brake power");
        c = checkInput("fuel power");
        d = checkInput("brake thermal efficiency");

        if (a & b & c & d){
             if (checkFuelType("Q1") == "A"){
                 var m = (755 * ((fuelDropLength.value * 9.04/2) / 10**6)) /ft
                 if (flow.value != data(m)){
                     alert("There is an error about fuel flow in your calculations!")
                 }
             
                 var n = 2 * Math.PI * t *  s/60
                 if (bPower.value != data(n)){
                     alert("There is an error about brake power in your calculations!")
                 } 

                 var p = 1000 *(m * 44400)
                 if (fPower.value != data(p)){
                     alert("There is an error about flue power in your calculations!")
                 }

                 var e = 100 * (n/p)
                 if (efficiency.value != data(e)){
                     alert("There is an error about brake thermal efficiency in your calculations!")
                 }
            
           // alert("Congratulation! All your calculations are correct!")
             }

             if (checkFuelType("Q1") == "B"){
                 var m = (832 * ((fuelDropLength.value * 9.04/2) / 10**6)) / ft
                 if (flow.value != data(m)){
                     alert("There is an error about fuel flow in your calculations!")
                 }
             
                 var n = 2 * Math.PI * t *  s/60
                 if (bPower.value != data(n)){
                     alert("There is an error about brake power in your calculations!")
                 } 

                 var p = 1000 * (m * 43400)
                 if (fPower.value != data(p)){
                     alert("There is an error about flue power in your calculations!")
                 }

                 var e = 100 * (n/p)
                 if (efficiency.value != data(e)){
                     alert("There is an error about brake thermal efficiency in your calculations!")
                 }
            
           // alert("Congratulation! All your calculations are correct!")
             }
        }
    
    }
</script>

</body>
</html>